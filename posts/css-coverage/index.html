<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>CSS coverage | Ben Reich</title>
<meta name=keywords content="shortcodes,privacy">
<meta name=description content="CSS coverage and it's implication on performance">
<meta name=author content="Ben">
<link rel=canonical href=https://benreich.dev/posts/css-coverage/>
<meta name=google-site-verification content="XYZabc">
<link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://benreich.dev/%3Clink%20/%20abs%20url%3E>
<link rel=icon type=image/png sizes=16x16 href=https://benreich.dev/%3Clink%20/%20abs%20url%3E>
<link rel=icon type=image/png sizes=32x32 href=https://benreich.dev/%3Clink%20/%20abs%20url%3E>
<link rel=apple-touch-icon href=https://benreich.dev/%3Clink%20/%20abs%20url%3E>
<link rel=mask-icon href=https://benreich.dev/%3Clink%20/%20abs%20url%3E>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-W33KZ2M31Y"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-W33KZ2M31Y',{anonymize_ip:!1})}</script>
<meta property="og:title" content="CSS coverage">
<meta property="og:description" content="CSS coverage and it's implication on performance">
<meta property="og:type" content="article">
<meta property="og:url" content="https://benreich.dev/posts/css-coverage/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-02-19T00:00:00+00:00">
<meta property="article:modified_time" content="2022-02-19T00:00:00+00:00"><meta property="og:site_name" content="BenReich">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="CSS coverage">
<meta name=twitter:description content="CSS coverage and it's implication on performance">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://benreich.dev/posts/"},{"@type":"ListItem","position":2,"name":"CSS coverage","item":"https://benreich.dev/posts/css-coverage/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"CSS coverage","name":"CSS coverage","description":"CSS coverage and it's implication on performance","keywords":["shortcodes","privacy"],"articleBody":"One typical workflow in my team is the development of a thing, the adoptance of said thing and a subsequent turn down or deprecation. Typically in the deprecation phase various code paths are removed and space is reclaimed. This is super useful as bloat in our JavaScript or C++ can cause load times (and sometimes lead to various tricky bugs).\nAn area that is often missed during this deprecation phase is the identification of CSS rules which will be orphaned by the removal of all this code. This leads to a proliferation of unused rules and can make the CSS rather unwieldy and depending on how long this problem goes unchecked, can lead to slower load times and bloated builds.\nThere are a number of open source tools out there that perform an analysis of the code base to identify unused CSS and report on it. For example PurgeCSS which uses Puppeteer and the Chrome Devtools CSS coverage tool to analyze and PurifyCSS which leverages static analysis.\nAt Google (specifically for my team) we’re not using Puppeteer for our tests and static analysis fails when JavaScript dynamically appends and removes CSS classes at runtime. Our team uses a framework call Browser Tests which sets up a Chrome browser process, loads all the test assets and instrumenting the browser behaves as a user would behave.\nBrowser Tests One of the nifty things with browser tests is you have deep access to the constituents that make Chrome so powerful, such as Devtools. We can\n","wordCount":"252","inLanguage":"en","datePublished":"2022-02-19T00:00:00Z","dateModified":"2022-02-19T00:00:00Z","author":{"@type":"Person","name":"Ben"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://benreich.dev/posts/css-coverage/"},"publisher":{"@type":"Organization","name":"Ben Reich","logo":{"@type":"ImageObject","url":"https://benreich.dev/%3Clink%20/%20abs%20url%3E"}}}</script>
</head>
<body class=dark id=top>
<script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://benreich.dev/ accesskey=h title="Ben Reich (Alt + H)">Ben Reich</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://benreich.dev/tags/ title=tags>
<span>tags</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<h1 class=post-title>
CSS coverage
</h1>
<div class=post-description>
CSS coverage and it's implication on performance
</div>
<div class=post-meta><span title="2022-02-19 00:00:00 +0000 UTC">February 19, 2022</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Ben&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/posts/css-coverage.md rel="noopener noreferrer" target=_blank>Suggest Changes</a>
</div>
</header>
<div class=post-content><p>One typical workflow in my team is the development of a thing, the adoptance of said thing and a subsequent turn down or deprecation. Typically in the deprecation phase various code paths are removed and space is reclaimed. This is super useful as bloat in our JavaScript or C++ can cause load times (and sometimes lead to various tricky bugs).</p>
<p>An area that is often missed during this deprecation phase is the identification of CSS rules which will be orphaned by the removal of all this code. This leads to a proliferation of unused rules and can make the CSS rather unwieldy and depending on how long this problem goes unchecked, can lead to slower load times and bloated builds.</p>
<p>There are a number of open source tools out there that perform an analysis of the code base to identify unused CSS and report on it. For example <a href=https://purgecss.com/>PurgeCSS</a> which uses Puppeteer and the Chrome Devtools CSS coverage tool to analyze and <a href=https://github.com/purifycss/purifycss>PurifyCSS</a> which leverages static analysis.</p>
<p>At Google (specifically for my team) we&rsquo;re not using Puppeteer for our tests and static analysis fails when JavaScript dynamically appends and removes CSS classes at runtime. Our team uses a framework call <a href=https://www.chromium.org/developers/testing/browser-tests/>Browser Tests</a> which sets up a Chrome browser process, loads all the test assets and instrumenting the browser behaves as a user would behave.</p>
<h2 id=browser-tests>Browser Tests<a hidden class=anchor aria-hidden=true href=#browser-tests>#</a></h2>
<p>One of the nifty things with browser tests is you have deep access to the constituents that make Chrome so powerful, such as Devtools. We can</p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://benreich.dev/tags/shortcodes/>shortcodes</a></li>
<li><a href=https://benreich.dev/tags/privacy/>privacy</a></li>
</ul>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2022 <a href=https://benreich.dev/>Ben Reich</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>